<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>أكاديمي بحر</title>
  <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@400;700&display=swap" rel="stylesheet" />
  <link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />
  <link href="https://unpkg.com/videojs-seek-buttons/dist/videojs-seek-buttons.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/es6-promise/4.2.8/es6-promise.auto.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/3.6.2/fetch.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
  <style>
    :root {
      --primary: #03506f;      /* لون أزرق غامق */
      --accent: #1282a2;       /* أزرق مائي */
      --bg-color: #001f29;     /* قاع البحر داكن */
      --text-color: #e0f7fa;   /* أبيض مزرق فاتح */
      --card-color: #003845;   /* أخضر محيطي */
      --border-color: #03506f;
    }
    [data-theme="light"] {
      --bg-color: #e0f7fa;
      --text-color: #001f29;
      --card-color: #ffffff;
      --border-color: #1282a2;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Almarai', sans-serif; user-select: none; }
    body { background: var(--bg-color); color: var(--text-color); line-height: 1.6; }
    .page { display: none; padding: 2rem; max-width: 1200px; margin: auto; }
    .page.active { display: block; animation: fadeIn .5s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px);} to { opacity: 1; transform: translateY(0);} }
    header { background: var(--card-color); padding: 1rem 2rem; display:flex; align-items:center; gap:2rem; position:sticky; top:0; z-index:100; box-shadow:0 3px 6px rgba(0,0,0,0.3); }
    .site-title { color: var(--primary); font-size:1.8rem; cursor:pointer; transition: .3s; }
    .site-title:hover { transform: scale(1.05);} 
    .search-container { flex-grow:1; max-width:600px; display:flex; gap:.5rem; }
    input, button { font-size:1rem; border-radius:8px; }
    #searchInput { flex:1; padding:.8rem; border:2px solid var(--border-color); background: var(--card-color); color:var(--text-color);}
    #searchButton, #themeToggle { padding:.8rem 1.2rem; background: var(--primary); color:#fff; border:none; cursor:pointer; transition:.3s; }
    #searchButton:hover, #themeToggle:hover { opacity:.9;}
    .teachers-grid { display:flex; overflow-x:auto; gap:2rem; padding:1rem 0; margin-top:2rem; }
    .teacher-card { background: var(--card-color); padding:1.5rem; border-radius:15px; min-width:280px; cursor:pointer; transition:.3s; flex-shrink:0; }
    .teacher-card:hover { transform: translateY(-5px); box-shadow:0 8px 20px rgba(0,0,0,.3);}
    .teacher-img { width:200px; height:200px; border-radius:50%; object-fit:cover; border:3px solid var(--accent); display:block; margin:auto; }
    .teacher-name { margin:1rem 0; text-align:center; font-size:1.2rem;}
    .classes-page { display:grid; gap:2rem; }
    .teacher-info { background: var(--card-color); padding:1.5rem; border-radius:10px; display:flex; gap:1rem; }
    .teacher-img-lg { width:120px; height:120px; border-radius:50%; border:3px solid var(--accent); object-fit:cover;}
    .back-button, .copy-button { background: var(--primary); color:#fff; border:none; padding:.8rem 1.5rem; border-radius:5px; cursor:pointer; transition:.3s; }
    .back-button:hover, .copy-button:hover { opacity:.9;}
    .classes-list { display:grid; gap:1.5rem;}
    .class-card { background: var(--card-color); padding:1rem; border-radius:10px; cursor:pointer;}
    .class-header { display:flex; justify-content:space-between; align-items:center; padding:1rem; border-left:4px solid var(--accent); }
    .lectures-list { display:none; gap:.8rem; margin-top:1rem; padding-right:1rem; }
    .lecture-item { position:relative; padding:1rem 1rem 1rem 2.5rem; background:var(--bg-color); border-radius:8px; border-right:3px solid var(--accent); cursor:pointer; transition:.3s; }
    .lecture-item:hover { background: #004f5a; transform: translateX(10px); }
    .checkmark { position:absolute; left:10px; top:50%; transform:translateY(-50%); font-size:1.2rem; color:var(--accent); }
    .video-page { display:flex; flex-direction:column; gap:2rem; }
    .video-container { position:relative; width:100%; padding-top:56.25%; background:#000; }
    .video-container .video-js { position:absolute; top:0; left:0; width:100%; height:100%;}
    .video-details { background: var(--card-color); padding:1.5rem; border-radius:10px; text-align:center;}
    .modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,.8); display:flex; justify-content:center; align-items:center; z-index:200;}
    .modal-content { background:var(--card-color); padding:1.5rem; border-radius:10px; text-align:center; position:relative; max-width:300px; width:90%; }
    .modal-content img { width:150px;height:150px;border-radius:50%;margin-bottom:1rem;}
    .modal-content a { display:inline-block; background:var(--primary); color:#fff; padding:.5rem 1rem; border-radius:8px; text-decoration:none; transition:.3s; }
    .modal-content a:hover { opacity:.9; }
    .close-modal { position:absolute; top:.5rem; left:.5rem; background:transparent; border:none; font-size:1.5rem; cursor:pointer; color:var(--text-color);}
    @media(max-width:768px){ header{flex-direction:column;} .teachers-grid{flex-direction:column;} .teacher-img{width:150px;height:150px;} }
  </style>
</head>
<body>
  <header>
    <h1 class="site-title" onclick="navigate('home')">أكاديمية بحر</h1>
    <button id="themeToggle">وضع/فاتح</button>
    <div class="search-container">
      <input id="searchInput" placeholder="ابحث عن مدرس…" />
      <button id="searchButton">🔍</button>
    </div>
  </header>

  <div id="homePage" class="page active">
    <div id="teachersGrid" class="teachers-grid"></div>
  </div>

  <div id="classesPage" class="page">
    <button class="back-button" onclick="navigate('home')">← المدرسين</button>
    <div class="teacher-info">
      <img id="teacherImage" class="teacher-img-lg" />
      <div><h2 id="teacherName"></h2><p id="teacherSubject"></p></div>
    </div>
    <div id="classesList" class="classes-list"></div>
  </div>

  <div id="videoPage" class="page">
    <div class="video-page">
      <div class="video-container">
        <video id="player" class="video-js vjs-default-skin" controls playsinline></video>
      </div>
      <div class="video-details">
        <h2 id="videoTitle"></h2>
        <p id="videoDescription"></p>
        <button class="copy-button" onclick="copyLectureLink()">نسخ رابط</button>
        <button class="back-button" onclick="navigate('classes')">← الفصول</button>
      </div>
    </div>
  </div>

  <div id="telegramModal" class="modal">
    <div class="modal-content">
      <button class="close-modal" onclick="closeModal()">×</button>
      <img src="https://j.top4top.io/p_34306njy91.png" alt="قناة تليجرام">
      <h3>اشترك في تيليجرام</h3>
      <p>تابع التحديثات</p>
      <a href="https://t.me/E_V_N" target="_blank">اذهب للقناة</a>
    </div>
  </div>

  <script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
  <script src="https://unpkg.com/videojs-seek-buttons/dist/videojs-seek-buttons.min.js"></script>
  <script type="text/babel">
    initializeTheme(); document.getElementById('themeToggle').addEventListener('click', toggleTheme);
    var completedLectures = JSON.parse(localStorage.getItem('completedLectures')||'{}');
    function initializeTheme(){
      var t=localStorage.getItem('theme')|| (window.matchMedia('(prefers-color-scheme: light)').matches?'light':'dark');
      document.documentElement.setAttribute('data-theme',t);
    }
    function toggleTheme(){
      var cur=document.documentElement.getAttribute('data-theme'),
          nxt=cur==='dark'?'light':'dark';
      document.documentElement.setAttribute('data-theme',nxt);
      localStorage.setItem('theme',nxt);
    }

    function saveCompleted(){ localStorage.setItem('completedLectures', JSON.stringify(completedLectures)); }
    function markLectureCompleted(url){if(!completedLectures[url]){completedLectures[url]=true; saveCompleted(); renderClasses(currentTeacher.classes); }}

    var videoPlayer=videojs('player',{controls:true,playbackRates:[0.5,1,1.25,1.5,2], html5:{hls:{overrideNative:true}}, controlBar:{pictureInPictureToggle:false,fullscreenToggle:true,volumePanel:false}});
    videoPlayer.seekButtons({forward:10,back:10});
    videoPlayer.on('ended', ()=>{ markLectureCompleted(currentLectureLink); nextVideo(); });

    var pages={'home':document.getElementById('homePage'),'classes':document.getElementById('classesPage'),'video':document.getElementById('videoPage')};
    var teachersGrid=document.getElementById('teachersGrid'),
        searchInput=document.getElementById('searchInput'),
        searchButton=document.getElementById('searchButton');

    var teachers=[], currentTeacher=null, currentClassIndex=0, currentLectureIndex=0, currentLectureLink='';

    function navigate(p){
      Object.values(pages).forEach(e=>e.classList.remove('active'));
      pages[p].classList.add('active');
      if(p!=='video'){ videoPlayer.pause(); videoPlayer.currentTime(0); }
      window.scrollTo(0,0);
    }

    function copyLectureLink(){ if(currentLectureLink) navigator.clipboard.writeText(currentLectureLink).then(()=>alert('تم النسخ')).catch(()=>alert('فشل النسخ')); }

    function renderTeachers(list){
      list=list||teachers;
      teachersGrid.innerHTML = list.length? list.map(t=>`
        <div class="teacher-card" onclick="showTeacher('${t.id}')">
          <img src="${t.image}" alt="${t.name}" class="teacher-img"/>
          <h3 class="teacher-name">${t.name}</h3><p>${t.subject}</p>
        </div>`).join('') : '<p>لا يوجد نتائج</p>';
    }

    function showTeacher(id){
      currentTeacher=teachers.find(t=>t.id===id); if(!currentTeacher)return;
      document.getElementById('teacherImage').src=currentTeacher.image;
      document.getElementById('teacherName').textContent=currentTeacher.name;
      document.getElementById('teacherSubject').textContent=currentTeacher.subject;
      renderClasses(currentTeacher.classes); navigate('classes');
    }

    function renderClasses(clsData){
      document.getElementById('classesList').innerHTML = clsData.map((cls, ci)=> {
        const lecturesHTML = cls.lectures.map((lec, li)=>`
          <div class="lecture-item" onclick="playVideo(${ci},${li},'${lec.url}','${lec.title}','${lec.description}')">
            ${li+1}. ${lec.title}${completedLectures[lec.url]?'<span class="checkmark">✔</span>':''}
          </div>`).join('');
        return `
          <div class="class-card">
            <div class="class-header" onclick="toggleLectures(this)">
              <h3>${cls.name}</h3><span>▼</span>
            </div>
            <div class="lectures-list">${lecturesHTML}</div>
          </div>`;
      }).join('');
    }

    function toggleLectures(el){
      const list=el.parentElement.querySelector('.lectures-list'),
            arrow=el.querySelector('span');
      if(list.style.display==='grid'){ list.style.display='none'; arrow.textContent='▼'; }
      else{ list.style.display='grid'; arrow.textContent='▲'; }
    }

    function playVideo(ci, li, url, title, desc){
      currentClassIndex=ci; currentLectureIndex=li; currentLectureLink=url;
      const type = url.endsWith('.m3u8')? 'application/vnd.apple.mpegurl':'video/mp4';
      videoPlayer.src({src:url, type}); videoPlayer.play();
      document.getElementById('videoTitle').textContent=title;
      document.getElementById('videoDescription').textContent=desc;
      navigate('video');
    }

    function nextVideo(){
      const cls=currentTeacher.classes;
      let ci=currentClassIndex, li=currentLectureIndex;
      if(li<cls[ci].lectures.length-1){ li++; }
      else if(ci<cls.length-1){ ci++; li=0; }
      else return;
      const next = cls[ci].lectures[li];
      playVideo(ci,li,next.url,next.title,next.description);
    }

    function handleSearch(){
      const term=searchInput.value.trim().toLowerCase();
      renderTeachers(teachers.filter(t=> t.name.toLowerCase().includes(term)|| t.subject.toLowerCase().includes(term)));
    }

    searchInput.addEventListener('input', ()=>{ clearTimeout(window.__st); window.__st=setTimeout(handleSearch,300); });
    searchButton.addEventListener('click', handleSearch);

    function loadData(){
      fetch('data.json')
        .then(r=>{ if(!r.ok)throw'فشل التحميل'; return r.json(); })
        .then(d=>{ teachers=d.teachers||[]; renderTeachers(); })
        .catch(e=>{ teachersGrid.innerHTML = `<p>خطأ: ${e}</p><button onclick="loadData()">إعادة</button>`; });
    }

    function closeModal(){ document.getElementById('telegramModal').style.display='none'; }
    document.addEventListener('contextmenu', e=>e.preventDefault());
    document.addEventListener('selectstart', e=>e.preventDefault());

    loadData();
  </script>
</body>
</html>
